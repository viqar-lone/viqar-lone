<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Grammar Error Spotting - MCQ Test</title>

    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-color: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --correct-color: #4CAF50;
            --incorrect-color: #f44336;
            --unattempted-color: #9e9e9e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-color);
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            min-height: 90vh;
        }
        
        /* Left Sidebar - Question Navigation */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            padding: 25px 15px;
            display: flex;
            flex-direction: column;
        }
        
        .test-info {
            margin-bottom: 30px;
        }
        
        .test-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
        }
        
        .test-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .timer-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .timer {
            font-size: 2.2rem;
            font-weight: 700;
            color: #ff6b6b;
            margin: 10px 0;
        }
        
        .questions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .question-btn {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .question-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .question-btn.active {
            background: #4cc9f0;
            border-color: #4cc9f0;
            box-shadow: 0 4px 12px rgba(76, 201, 240, 0.4);
        }
        
        .question-btn.attempted {
            background: var(--correct-color);
            border-color: var(--correct-color);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }
        
        .question-btn.unattempted {
            background: var(--unattempted-color);
            border-color: var(--unattempted-color);
        }
        
        .question-btn.correct {
            background: var(--correct-color);
            border-color: var(--correct-color);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }
        
        .question-btn.wrong {
            background: var(--incorrect-color);
            border-color: var(--incorrect-color);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.4);
        }
        
        /* Main Content Area */
     .main-content {
    flex: 1;
    padding: 40px 50px 100px 50px; /* Added 100px bottom padding for navigation */
    overflow-y: auto;
    max-height: 90vh;
    width: calc(100% - 280px);
    display: flex;
    flex-direction: column;
    min-height: 500px;
    position: relative;
}
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .question-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        /* Image before question */
        .question-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Paragraph before question */
        .question-paragraph {
    background: #f8f9fa;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 12px;
    border-left: 4px solid var(--primary-color);
    font-size: 0.90rem;
    line-height: 1.35;
    color: #495057;
    white-space: pre-line;
    max-height: 230px;
    overflow-y: auto;
}
        
        .question-text {
    font-size: 0.9rem;
    line-height: 1.4;
    margin-bottom: 8px;
    color: #212529;
    font-weight: 500;
}
        
        .options-container {
            margin: 30px 0;
        }
        
        .option {
            background: var(--light-color);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .option:hover {
            border-color: var(--primary-color);
            background: rgba(67, 97, 238, 0.05);
            transform: translateX(5px);
        }
        
        .option.selected {
            border-color: var(--primary-color);
            background: rgba(67, 97, 238, 0.1);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.15);
        }
        
        .option.correct {
            border-color: var(--correct-color);
            background: rgba(76, 175, 80, 0.15);
        }
        
        .option.incorrect {
            border-color: var(--incorrect-color);
            background: rgba(244, 67, 54, 0.15);
        }
        
        .option.unattempted {
            border-color: var(--unattempted-color);
            background: rgba(158, 158, 158, 0.1);
        }
        /* Mocks Wallah Style Checkmarks - Blue, Green, Red only */
.option {
    position: relative;
    padding-right: 60px;
}

.option::after {
    content: '';
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    width: 24px;
    height: 24px;
    border-radius: 50%;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 12px;
    color: white;
}

.option.selected::after {
    background: var(--primary-color); /* Blue checkmark */
    content: '‚úì';
}

.option.correct::after {
    background: var(--correct-color); /* Green checkmark */
    content: '‚úì';
}

.option.incorrect::after {
    background: var(--incorrect-color); /* Red cross */
    content: '‚úó';
}

/* No other changes - keep your current colors */

        .option-label {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .option.correct .option-label {
            background: var(--correct-color);
        }
        
        .option.incorrect .option-label {
            background: var(--incorrect-color);
        }
        
        .option.unattempted .option-label {
            background: var(--unattempted-color);
        }
        
        .option-text {
            flex: 1;
            font-size: 0.83rem;
            line-height: 1.33;
        }
        
        /* Action Buttons */

               /* General nav-btn styles for other buttons (Submit, Back to Test, etc.) */
        .nav-btn {
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-btn.prev {
            background: var(--light-color);
            color: var(--dark-color);
            border: 2px solid var(--border-color);
        }
        
        .nav-btn.next {
            background: var(--primary-color);
            color: white;
        }
        
        .nav-btn.submit {
            background: #4CAF50;
            color: white;
            padding: 14px 40px;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
            /* Navigation Buttons - Fixed at bottom */
.navigation {
    position: fixed; 
    bottom: 0;
    left: 300px; /* Sidebar width */
    right: 0;
    width: calc(100% - 300px);
    background: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    border-top: 2px solid var(--border-color);
    box-shadow: 0 -2px 15px rgba(0,0,0,.08);
    z-index: 100;
    gap: 15px;    
}

/* Specific buttons inside fixed navigation */
.navigation .prev,
.navigation .clear,
.navigation .next {
    flex: 1;
    padding: 12px 15px;
    border-radius: 12px;
    border: none;
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-height: 45px;
}

.navigation .prev {
    background: var(--light-color);
    color: var(--dark-color);
    border: 2px solid var(--border-color);
}

.navigation .clear {
    background: #ffebee;
    color: var(--incorrect-color);
    border: 2px solid #ffcdd2;
    max-width: 150px;
    flex: none;
}

.navigation .next {
    background: var(--primary-color);
    color: white;
}

.navigation .prev:hover:not(:disabled),
.navigation .clear:hover:not(:disabled),
.navigation .next:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.navigation .prev:disabled,
.navigation .next:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
              
        
        /* Result Panel */
        .result-panel {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            margin-top: 30px;
        }
        
        .result-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        /* Analysis Page Styling */
        .analysis-page {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            min-height: 90vh;
            padding: 40px;
        }
        
        .analysis-page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .analysis-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .analysis-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .analysis-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .score-display-large {
            font-size: 5rem;
            font-weight: 700;
            color: var(--correct-color);
            margin: 20px 0;
        }
        
        .analysis-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .analysis-stat-card {
            background: var(--light-color);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .analysis-stat-card:hover {
            transform: translateY(-5px);
        }
        
        .analysis-stat-value {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .analysis-stat-label {
            color: #666;
            font-size: 1rem;  /* ‚úÖ CORRECT */
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .analysis-correct .analysis-stat-value { color: var(--correct-color); }
        .analysis-incorrect .analysis-stat-value { color: var(--incorrect-color); }
        .analysis-unanswered .analysis-stat-value { color: var(--unattempted-color); }
        
        .detailed-analysis {
            margin: 40px 0;
        }
        
        .detailed-analysis-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .question-analysis-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .question-analysis-item.correct {
            border-left-color: var(--correct-color);
            background: rgba(76, 175, 80, 0.05);
        }
        
        .question-analysis-item.incorrect {
            border-left-color: var(--incorrect-color);
            background: rgba(244, 67, 54, 0.05);
        }
        
        .question-analysis-item.unattempted {
            border-left-color: var(--unattempted-color);
            background: rgba(158, 158, 158, 0.05);
        }
        
        .question-analysis-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .question-analysis-number {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .question-analysis-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 5px 0;
        }
        
        .status-correct {
            background: rgba(76, 175, 80, 0.2);
            color: var(--correct-color);
        }
        
        .status-incorrect {
            background: rgba(244, 67, 54, 0.2);
            color: var(--incorrect-color);
        }
        
        .status-unattempted {
            background: rgba(158, 158, 158, 0.2);
            color: var(--unattempted-color);
        }
        
        .analysis-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
        }
        
        .analysis-btn {
            padding: 15px 30px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size : 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .analysis-btn.back {
            background: var(--primary-color);
            color: white;
        }
        
        .analysis-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .result-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .score-display {
            font-size: 4rem;
            font-weight: 700;
            color: var(--correct-color);
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: var(--light-color);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .correct .stat-value { color: var(--correct-color); }
        .incorrect .stat-value { color: var(--incorrect-color); }
        .unanswered .stat-value { color: var(--unattempted-color); }
        
        /* Explanation Section */
        .explanation {
            background: #e8f5e9;
            border-left: 4px solid var(--correct-color);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            display: none;
        }
        
        .explanation.show {
            display: block;
        }
        
        .explanation-title {
            color: #2e7d32;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* View Solutions Section */
        .solutions-panel {
            display: none;
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
        }
        
        .solutions-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .solutions-title {
            color: #7b1fa2;
            font-weight: 600;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .solution-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #e1bee7;
        }
        
        .solution-question {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .solution-answer {
            color: var(--correct-color);
            font-weight: 600;
            margin: 5px 0;
        }
        
        .solution-explanation {
            color: #666;
            font-size: 0.95rem;
            margin-top: 10px;
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .test-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 20px;
            }
            
            .questions-grid {
                max-height: 200px;
            }
            
            .main-content {
                width: 100%;
                padding: 20px;
                padding-bottom: 100px;
            }
            
            .analysis-page {
                padding: 20px;
            }
            .navigation {
        width: 100%; /* Full width on mobile */
        left: 0;
    }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .option {
                padding: 15px;
            }
            
            .questions-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .question-btn {
                width: 40px;
                height: 40px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .question-image {
                max-height: 200px;
            }
            
            .analysis-stats {
                grid-template-columns: 1fr;
            }
            
            .analysis-actions {
                flex-direction: column;
            }
        }
        
        /* Status Indicators */
        .status-indicators {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .attempted-dot { background: var(--correct-color); }
        .current-dot { background: #2196F3; }
        .unattempted-dot { background: var(--unattempted-color); }

/* Fixed Navigation Responsive */
@media (max-width: 1024px) {
    .navigation {
        left: 0;
        width: 100%;
    }
    
    .main-content {
        padding-bottom: 100px;
    }
}

@media (max-width: 768px) {
    .navigation {
        padding: 10px 12px;
        gap: 10px;
    }
    
    .navigation .prev,
    .navigation .clear,
    .navigation .next {
        padding: 10px 12px;
        font-size: 0.85rem;
        min-height: 40px;
    }
    
    .navigation .clear {
        max-width: 120px;
    }
}
     
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loader {
            width: 50px;
            height : 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* View Solutions Button */
        .view-solutions-btn {
            display: none;
            background: #9c27b0;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            margin: 30px auto;
            transition: all 0.3s ease;
            align-items: center;
            gap: 10px;
        }
        
        .view-solutions-btn:hover {
            background: #7b1fa2;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.3);
        }
        
        .view-solutions-btn.show {
            display: flex;
        }
    </style>
<script id="testConfig" type="application/json">{
    "totalQuestions": 20,
    "timeLimit": 1200,
    "negativeMarking": 0.25,
    "correctAnswers": [1, 1, 2, 0, 2, 1, 2, 2, 0, 1, 0, 1, 1, 1, 2, 1, 2, 1, 0, 1],
    "questions": [
        {
            "text": "According to the Nilmat Purana, the Kashmir Valley was originally a huge lake known as:",
            "options": ["(a) Dal Lake", "(b) Satisar", "(c) Wular", "(d) Mansar"],
            "explanation": "According to Nilmat Purana, the valley originally was a huge lake called Satisar[cite: 5, 6]."
        },
        {
            "text": "The word 'Kashmir' is derived from two words 'Ka' and 'Shimeera'. What does 'Shimeera' mean?",
            "options": ["(a) To flow", "(b) To dry up", "(c) Mountain", "(d) Snow"],
            "explanation": "'Ka' means water and 'Shimeera' means to dry up[cite: 10]."
        },
        {
            "text": "Who founded the old city of Srinagar, originally known as Pandrethan?",
            "options": ["(a) Kanishka", "(b) Lalitaditya", "(c) Ashoka", "(d) Gonanda I"],
            "explanation": "Ashoka conquered Kashmir in 250 BC and built the Old city of Srinagar now called Pandrethan[cite: 100, 102]."
        },
        {
            "text": "Who is considered the author of the 'Rajatarangini'?",
            "options": ["(a) Kalhana", "(b) Jonaraja", "(c) Abul Fazal", "(d) Bilhana"],
            "explanation": "Rajatarangini was written in Sanskrit by Pandit Kalhana in 1149-50 AD[cite: 33]."
        },
        {
            "text": "Which ruler is historically referred to as the 'Samudra Gupta of Kashmir'?",
            "options": ["(a) Avantivarman", "(b) Durlabhvardhan", "(c) Lalitaditya Muktapida", "(d) Shihab-ud-din"],
            "explanation": "Lalitaditya (724-760 AD) is called the Samudra Gupta of Kashmir due to his vast conquests[cite: 147]."
        },
        {
            "text": "The Fourth Buddhist Council was held in Kashmir during the reign of which ruler?",
            "options": ["(a) Ashoka", "(b) Kanishka", "(c) Jaluka", "(d) Mihirkula"],
            "explanation": "Kanishka convened the 4th Buddhist council at Kundalvan, Kashmir[cite: 114]."
        },
        {
            "text": "Who founded the Utpala Dynasty in Kashmir?",
            "options": ["(a) Shankaravarman", "(b) Suyya", "(c) Avantivarman", "(d) Queen Didda"],
            "explanation": "Avantivarman is the founder of the Utpala dynasty [855-883 AD][cite: 199]."
        },
        {
            "text": "Who was the famous engineer during Avantivarman's reign who regulated the course of the Jhelum river?",
            "options": ["(a) Cinkuna", "(b) Sura", "(c) Suyya", "(d) Abul Fazal"],
            "explanation": "A great role was played by public work minister Suyya (the great engineer) who cleared the river bed and erected embankments[cite: 206, 207]."
        },
        {
            "text": "Who was the first Sultan of the Shah Mir Dynasty?",
            "options": ["(a) Shams-ud-din Shah Mir", "(b) Sultan Sikandar", "(c) Zain-ul-Abidin", "(d) Shihab-ud-din"],
            "explanation": "Shah Mir proclaimed himself as ruler under the title Sultan Shams-ud-din Shah Mir in 1339[cite: 353, 355]."
        },
        {
            "text": "Which ruler is known as 'Butshikhan' (Idol Breaker) for his suppression of non-Muslims?",
            "options": ["(a) Shah Mir", "(b) Sultan Sikandar", "(c) Ali Shah", "(d) Zain-ul-Abidin"],
            "explanation": "Sultan Sikandar ordered temples to be pulled down and came to be called Butshikhan or destroyer of idols[cite: 393, 394]."
        },
        {
            "text": "Who is popularly known as the 'Akbar of Kashmir'?",
            "options": ["(a) Sultan Zain-ul-Abidin", "(b) Sultan Sikandar", "(c) Yousaf Shah Chak", "(d) Shams-ud-din"],
            "explanation": "Sultan Zain-ul-Abidin is called the Akbar of Kashmir due to his tolerance and reforms[cite: 468]."
        },
        {
            "text": "In which year did Kashmir become a part of the Mughal Empire under Akbar?",
            "options": ["(a) 1556", "(b) 1586", "(c) 1605", "(d) 1753"],
            "explanation": "Mughals entered victorious on October 14, 1586, and Kashmir became part of the Mughal empire[cite: 508]."
        },
        {
            "text": "Who built the Shalimar Garden in Kashmir?",
            "options": ["(a) Akbar", "(b) Jahangir", "(c) Shah Jahan", "(d) Aurangzeb"],
            "explanation": "Shalimar garden was built by Jahangir[cite: 551]."
        },
        {
            "text": "Who was the first Afghan governor of Kashmir?",
            "options": ["(a) Ahmed Shah Abdali", "(b) Abdullah Khan Ishaq Aqasi", "(c) Atta Mohammad Khan", "(d) Jabbar Khan"],
            "explanation": "Abdullah Khan Ishaq Aqasi was the first Afghan governor[cite: 593]."
        },
        {
            "text": "Maharaja Ranjit Singh annexed Kashmir to the Sikh Empire in which year?",
            "options": ["(a) 1808", "(b) 1846", "(c) 1819", "(d) 1857"],
            "explanation": "Maharaja Ranjit Singh of Punjab succeeded in annexing Kashmir in his third attempt in 1819[cite: 636]."
        },
        {
            "text": "According to the Treaty of Amritsar (1846), Gulab Singh acquired Jammu and Kashmir for a payment of:",
            "options": ["(a) 50 Lakh Rupees", "(b) 75 Lakh Rupees", "(c) 1 Crore Rupees", "(d) 100 Lakh Rupees"],
            "explanation": "Jammu and Kashmir was given to Gulab Singh in 75 lakh rupees via the Treaty of Amritsar[cite: 778]."
        },
        {
            "text": "Who established the J&K High Court in 1928?",
            "options": ["(a) Pratap Singh", "(b) Ranbir Singh", "(c) Hari Singh", "(d) Gulab Singh"],
            "explanation": "High court was established in 1929 (constitution 1928) during the reign of Hari Singh[cite: 983]."
        },
        {
            "text": "Who founded the 'All Jammu and Kashmir Muslim Conference' in 1932?",
            "options": ["(a) Chaudhry Ghulam Abbas", "(b) Sheikh Abdullah", "(c) Mirwaiz Yusuf Shah", "(d) Prem Nath Dogra"],
            "explanation": "In October 1932, the first political party 'All Jammu and Kashmir Muslim Conference' was set up by Sheikh Abdullah[cite: 1013, 1014]."
        },
        {
            "text": "On which date did Maharaja Hari Singh sign the Instrument of Accession?",
            "options": ["(a) 26 October 1947", "(b) 15 August 1947", "(c) 22 October 1947", "(d) 27 October 1947"],
            "explanation": "Maharaja Hari Singh signed the Instrument of Accession on 26 October, 1947[cite: 1041]."
        },
        {
            "text": "Who was the last ruling Maharaja of the Dogra Dynasty?",
            "options": ["(a) Pratap Singh", "(b) Hari Singh", "(c) Ranbir Singh", "(d) Karan Singh"],
            "explanation": "Hari Singh (1925-1948) was the nephew of Pratap Singh and the last ruler before accession[cite: 935]."
        }
    ],
    "testTitle": "History of Jammu & Kashmir - Mock Test"
}</script>
</head>
<body>
    <!-- Start Test Screen with Details -->
    <div id="startScreen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 500px; width: 90%; text-align: center;">
            
            <!-- Title -->
            <h1 style="color: #4361ee; font-size: 28px; margin-bottom: 30px; font-weight: 700;"> MOCK TEST</h1>
            
            <!-- Test Details -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-bottom: 30px; text-align: left;">
                <div style="font-size: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #666;">üìã Title:</span>
                    <span style="color: #4361ee; font-weight: 600;" id="startTestTitle">Loading...</span>
                </div>
                
                <div style="font-size: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #666;">üî¢ Questions:</span>
                    <span style="color: #4361ee; font-weight: 600;" id="startTotalQ">0</span>
                </div>
                
                <div style="font-size: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #666;">‚è±Ô∏è Time Limit:</span>
                    <span style="color: #4361ee; font-weight: 600;" id="startTimeLimit">0 minutes</span>
                </div>
                
                <div style="font-size: 16px; display: flex; align-items: center; gap: 10px;">
                    <span style="color: #666;">‚ûñ Negative Marking:</span>
                    <span style="color: #4361ee; font-weight: 600;" id="startNegative">No</span>
                </div>
            </div>
            
            <!-- Start Button -->
            <button id="startButton" 
                style="background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%); 
                       color: white; border: none; padding: 18px 40px; 
                       font-size: 20px; font-weight: 600; border-radius: 12px; 
                       cursor: pointer; width: 100%; transition: all 0.3s ease;
                       margin-bottom: 20px;"
                onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 40px rgba(67, 97, 238, 0.6)';"
                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                üöÄ START TEST
            </button>
            
            <!-- Permanent Text Below Button -->
            <div style="color: #888; font-size: 14px; padding-top: 15px; border-top: 1px solid #eee;">
</div>
        </div>
    </div>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div style="font-size: 1.2rem; color: var(--primary-color); margin-top: 20px;">
            Loading Test...
        </div>
    </div>

    <!-- Test Container -->
    <div class="test-container" id="testContainer">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="test-info">
                <h1 class="test-title" id="testTitleDisplay">Test Title</h1>
                <div class="test-meta">
                    <div class="meta-item">
                        <span>üìù</span>
                        <span id="totalQuestionsDisplay">0 Questions</span>
                    </div>
                    <div class="meta-item">
                        <span>‚è±Ô∏è</span>
                        <span id="timeLimitDisplay">0 Minutes</span>
                    </div>
                    <div class="meta-item">
                        <span>‚ûñ</span>
                        <span id="negativeMarkingDisplay">No Negative</span>
                    </div>
                </div>
            </div>
            
            <div class="timer-container">
                <div style="font-size: 0.9rem; opacity: 0.8;">Time Remaining</div>
                <div class="timer" id="timer">00:00</div>
                <div style="font-size: 0.8rem; opacity: 0.7;">Auto-submit when timer ends</div>
            </div>
            
            <div style="margin-top: 20px;">
                <div style="font-weight: 600; margin-bottom: 15px;">Question Navigation</div>
                <div class="questions-grid" id="questionsGrid">
                    <!-- Question buttons will be generated here -->
                </div>
                
                <div class="status-indicators">
                    <div class="status-item">
                        <div class="status-dot correct-dot"></div>
                        <span>Correct</span>
                    </div>
                    <div class="status-item">
                        <div class="status-dot wrong-dot"></div>
                        <span>Wrong</span>
                    </div>
                    <div class="status-item">
                        <div class="status-dot unattempted-dot"></div>
                        <span>Unattempted</span>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: auto; padding-top: 20px;">
                <button class="nav-btn submit" onclick="submitTest()" style="width: 100%;">
                    üì§ Submit Test
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="question-header">
                <div class="question-number" id="questionNumber">Question 1 of 0</div>
                <div id="scoreDisplay" style="font-size: 0.9rem; color: #666; display: none;">
                    Score: <span id="currentScore">0</span>/<span id="totalQuestions">0</span>
                </div>
            </div>
            
            <!-- Image before question -->
            <div id="questionImageContainer"></div>
            
            <!-- Paragraph before question -->
            <div id="questionParagraphContainer"></div>
            
            <div class="question-text" id="questionText">
                <!-- Question text will be inserted here -->
            </div>
            
            <div class="options-container" id="optionsContainer">
                <!-- Options will be inserted here -->
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                
            </div>
            
            <div class="explanation" id="explanation">
                <div class="explanation-title">
                    <span>üí°</span>
                    <span>Explanation</span>
                </div>
                <div id="explanationText"></div>
            </div>
            
         <!-- Fixed Navigation at the bottom - DOES NOT SCROLL -->
<div class="navigation">
    <button class="prev" onclick="prevQuestion()" id="prevBtn">
        ‚Üê Previous
    </button>

    <button class="clear" onclick="clearResponse()" id="clearBtn">
        üóëÔ∏è Clear Response
    </button>

    <button class="next" onclick="nextQuestion()" id="nextBtn">
        Next ‚Üí
    </button>
</div>
            
            <!-- View Solutions Button -->
            <button class="view-solutions-btn" id="viewSolutionsBtn" onclick="showAllSolutions()">
                üìö View All Solutions
            </button>
            
            <!-- Solutions Panel -->
            <div class="solutions-panel" id="solutionsPanel">
                <div class="solutions-title">
                    <span>üìö</span>
                    <span>All Solutions</span>
                </div>
                <div id="solutionsContent"></div>
            </div>
            
            <!-- Result Panel -->
            <div class="result-panel" id="resultPanel">
                <div class="result-header">
                    <h2 class="result-title">Test Completed! üéâ</h2>
                    <div class="score-display" id="finalScore">0/0</div>
                    <div style="font-size: 1.2rem; color: #666; margin-bottom: 20px;">
                        Time Taken: <span id="timeTaken">00:00</span>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card correct">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">Correct Answers</div>
                    </div>
                    <div class="stat-card incorrect">
                        <div class="stat-value" id="incorrectCount">0</div>
                        <div class="stat-label">Wrong Answers</div>
                    </div>
                    <div class="stat-card unanswered">
                        <div class="stat-value" id="unansweredCount">0</div>
                        <div class="stat-label">Unanswered</div>
                    </div>
                </div>
                
                <div style="background: #fff3cd; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 4px solid #ffc107;">
                    <div style="font-weight: 600; color: #856404; margin-bottom: 10px;">
                        ‚ö†Ô∏è Negative Marking Summary
                    </div>
                    <div id="negativeMarkingInfo"></div>
                </div>
                
              <div style="margin-top: 30px;">
    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                <!-- üìä View Analysis Button -->
       <button class="nav-btn" onclick="goToAnalysisFromResults()" style="background: #4361ee; color: white;">
            üìä View Analysis
        </button>
        
        <!-- üìö View All Solutions Button -->
      <button class="nav-btn" onclick="showAllSolutions()" style="background: #9c27b0; color: white;">
            üìö View All Solutions
        </button>
    </div>
</div>
            </div>
        </div>
    </div>

        <!-- Analysis Page -->
    <div class="analysis-page" id="analysisPage">
        <div class="analysis-header">
            <h1 class="analysis-title">üìä Test Analysis Report</h1>
            <div class="analysis-subtitle" id="analysisTestTitle">Test Title</div>
            <div class="score-display-large" id="analysisFinalScore">0/0</div>
            <div style="font-size: 1.2rem; color: #666;">
                Time Taken: <span id="analysisTimeTaken">00:00</span>
            </div>
        </div>
        
                <div class="analysis-stats">
            <div class="analysis-stat-card analysis-correct">
                <div class="analysis-stat-value" id="analysisCorrectCount">0</div>
                <div class="analysis-stat-label">Correct Answers</div>
            </div>
            <div class="analysis-stat-card analysis-incorrect">
                <div class="analysis-stat-value" id="analysisIncorrectCount">0</div>
                <div class="analysis-stat-label">Wrong Answers</div>
            </div>
            <div class="analysis-stat-card analysis-unanswered">
                <div class="analysis-stat-value" id="analysisUnansweredCount">0</div>
                <div class="analysis-stat-label">Unanswered</div>
            </div>
        </div>
        
                <div style="background: #fff3cd; padding: 25px; border-radius: 12px; margin: 30px 0; border-left: 4px solid #ffc107;">
            <div style="font-weight: 600; color: #856404; margin-bottom: 15px; font-size: 1.2rem;">
                üìù Performance Summary
            </div>
            <div id="analysisPerformanceSummary">
                <!-- Performance summary will be inserted here -->
            </div>
        </div>
        
        <!-- Previous Attempts Section -->
        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin: 25px 0;">
            <div style="font-weight: 600; color: #4361ee; margin-bottom: 15px; font-size: 1.2rem; display: flex; align-items: center; gap: 8px;">
                üìä Previous Attempts
            </div>
            <!-- ‚ùå REMOVE: max-height and overflow-y (no scrolling) -->
<div id="previousAttemptsContainer" style="padding-right: 10px;">
                <!-- Previous attempts will appear here -->
            </div>
        </div>
        
        <!-- Buttons at the end -->
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
            <button onclick="backToTest()" class="nav-btn" style="background: #4361ee; color: white;">
                ‚Üê Back to Test
            </button>
         </div>
    </div>

    <script>
        // Configuration - Will be set when page loads
        let CONFIG = {
            totalQuestions: 0,
            timeLimit: 0,
            negativeMarking: 0,
            correctAnswers: [],
            questions: [],
            testTitle: "MCQ Test"
        };
        
        // State
        let currentQuestion = 0;
        let userAnswers = [];
        let timeLeft = 0;
        let timerInterval;
        let testSubmitted = false;
        let testStartTime = Date.now();
        let questionStatus = [];

// ========== ADD THESE 3 FUNCTIONS ==========
function saveTestAttempt(score, total, correct, incorrect, unanswered, timeTaken) {
    const testKey = `test_${CONFIG.testTitle.replace(/\s+/g, '_')}_attempts`;
    const attempts = JSON.parse(localStorage.getItem(testKey)) || [];
    
    attempts.unshift({
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString(),
        score: score.toFixed(2),
        total: total,
        correct: correct,
        incorrect: incorrect,
        unanswered: unanswered,
        timeTaken: timeTaken,
        percentage: ((score / total) * 100).toFixed(1)
    });
    
    if (attempts.length > 5) attempts.pop();
    localStorage.setItem(testKey, JSON.stringify(attempts));
}

function getPreviousAttempts() {
    const testKey = `test_${CONFIG.testTitle.replace(/\s+/g, '_')}_attempts`;
    return JSON.parse(localStorage.getItem(testKey)) || [];
}

function displayPreviousAttempts() {
    const attempts = getPreviousAttempts();
    const container = document.getElementById('previousAttemptsContainer');
    
    if (!container) return;
    
    if (attempts.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">No previous attempts found.</div>';
        return;
    }
    
    let html = '';
    attempts.forEach((attempt, index) => {
        const timeFormatted = `${Math.floor(attempt.timeTaken / 60)}:${(attempt.timeTaken % 60).toString().padStart(2, '0')}`;
        let attemptEmoji = '';
        let attemptNumber = '';
        let borderColor = '#ddd';
        
        switch(index) {
            case 0:
                attemptEmoji = 'üèÜ';  // Trophy emoji for latest
                attemptNumber = 'Latest Attempt';
                borderColor = '#FFD700'; // Gold color
                break;
            case 1:
                   attemptEmoji = '1Ô∏è‚É£';  // Number 1 emoji
                attemptNumber = 'Previous Attempt';
                borderColor = '#4ECDC4'; // Teal color
                break;
            case 2:
                attemptEmoji = '2Ô∏è‚É£';  // Number 2 emoji
                attemptNumber = 'Earlier Attempt';
                borderColor = '#FFD166'; // Yellow color
                break;
            case 3:
                attemptEmoji = '3Ô∏è‚É£';  // Number 3 emoji
                attemptNumber = 'Old Attempt';
                borderColor = '#06D6A0'; // Green color
                break;
            case 4:
                attemptEmoji = '4Ô∏è‚É£';  // Number 4 emoji
                attemptNumber = 'First Attempt';
                borderColor = '#118AB2'; // Blue color
                break;
            default:
                // This shouldn't happen since we limit to 5
                attemptEmoji = 'üìù';
                attemptNumber = `${index + 1}th Attempt`;
                borderColor = '#666';
                break;
        }

        html += `
           <div style="background: white; border-radius: 10px; padding: 15px; margin-bottom: 12px; border-left: 4px solid ${borderColor}; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div style="font-weight: 700; color: #333; font-size: 16px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">${attemptEmoji}</span>
                        <span>${attemptNumber}</span>
                    </div>
                    <div style="font-size: 12px; color: #666; background: #f5f5f5; padding: 4px 10px; border-radius: 12px;">
                        ${attempt.date}
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 10px;">
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 10px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: #4361ee;">${attempt.score}</div>
                        <div style="font-size: 12px; color: #666;">Score / ${attempt.total}</div>
                    </div>
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 10px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: #4CAF50;">${attempt.correct}</div>
                        <div style="font-size: 12px; color: #666;">Correct</div>
                    </div>
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 10px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: #f44336;">${attempt.incorrect}</div>
                        <div style="font-size: 12px; color: #666;">Wrong</div>
                    </div>
                    <div style="background: #f8f9fa; border-radius: 8px; padding: 10px; text-align: center;">
                        <div style="font-size: 20px; font-weight: 800; color: #FF9800;">${attempt.unanswered}</div>
                        <div style="font-size: 12px; color: #666;">Unanswered</div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 13px; color: #666; padding-top: 10px; border-top: 1px solid #eee;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="display: flex; align-items: center; gap: 4px;">‚è±Ô∏è ${timeFormatted}</span>
                        <span style="display: flex; align-items: center; gap: 4px;">üìä ${attempt.percentage}%</span>
                    </div>
                    <div style="font-weight: 600; color: #888;">
                        ${attempt.time}
                    </div>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}
// ========== END OF ADDED FUNCTIONS ==========
        
        // Initialize test with data from URL or default
        function initTest() {
            try {
                // Get test data from URL parameters or use defaults
                const urlParams = new URLSearchParams(window.location.search);
                
                // Try to get embedded data from script tag
                const configScript = document.getElementById('testConfig');
                if (configScript) {
                    try {
                        CONFIG = JSON.parse(configScript.textContent);
                    } catch (e) {
                        console.log("Could not parse config from script tag:", e);
                    }
                }
                
                // Set up test data
                if (CONFIG.totalQuestions === 0 && CONFIG.questions.length > 0) {
                    CONFIG.totalQuestions = CONFIG.questions.length;
                }
                
                // Initialize arrays
                userAnswers = new Array(CONFIG.totalQuestions).fill(null);
                questionStatus = new Array(CONFIG.totalQuestions).fill('unattempted');
                timeLeft = CONFIG.timeLimit || 1800; // Default 30 minutes
                
                // Update UI displays
                document.getElementById('testTitleDisplay').textContent = CONFIG.testTitle || "MCQ Test";
                document.getElementById('totalQuestionsDisplay').textContent = CONFIG.totalQuestions + " Questions";
                document.getElementById('totalQuestions').textContent = CONFIG.totalQuestions;
                
                // Calculate and display time
                const minutes = Math.floor(timeLeft / 60);
                document.getElementById('timeLimitDisplay').textContent = minutes + " Minutes";
                
                // Display negative marking
                let negativeDisplay = "No";
                if (CONFIG.negativeMarking === 0.25) {
                    negativeDisplay = "1/4";
                } else if (CONFIG.negativeMarking === 0.33) {
                    negativeDisplay = "1/3";
                } else if (CONFIG.negativeMarking === 0.5) {
                    negativeDisplay = "1/2";
                }
                document.getElementById('negativeMarkingDisplay').textContent = "Negative: " + negativeDisplay;
                
                // Initialize question navigation grid
                initQuestionGrid();
                
                // Load first question
                loadQuestion(0);
                
                // Start timer
                startTimer();
                
                // Load saved answers
                loadSavedAnswers();
                
                // Hide loading screen after 1 second
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error("Error initializing test:", error);
                document.getElementById('loadingScreen').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="color: #f44336; font-size: 2rem; margin-bottom: 20px;">‚ö†Ô∏è Error</div>
                        <div style="color: #666; margin-bottom: 20px;">Failed to load test. Please check the test file.</div>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: #4361ee; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Reload Page
                        </button>
                    </div>
                `;
            }
        }
        
        // Initialize question grid
        function initQuestionGrid() {
            const grid = document.getElementById('questionsGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < CONFIG.totalQuestions; i++) {
                const btn = document.createElement('button');
                btn.className = 'question-btn';
                btn.textContent = i + 1;
                btn.onclick = () => navigateToQuestion(i);
                btn.id = `qBtn${i}`;
                grid.appendChild(btn);
            }
        }
        
        // Load question
        function loadQuestion(index) {
            if (index < 0 || index >= CONFIG.totalQuestions) return;
            
            currentQuestion = index;
            const question = CONFIG.questions[index];
            
            if (!question) {
                console.error("Question not found at index:", index);
                return;
            }
            
            // Update question number
            document.getElementById('questionNumber').textContent = 
                `Question ${index + 1} of ${CONFIG.totalQuestions}`;
            
            // Clear previous image and paragraph
            document.getElementById('questionImageContainer').innerHTML = '';
            document.getElementById('questionParagraphContainer').innerHTML = '';
            
            // Load image if exists
            if (question.image && question.image.startsWith('data:image')) {
                const imgContainer = document.getElementById('questionImageContainer');
                const img = document.createElement('img');
                img.src = question.image;
                img.alt = 'Question Image';
                img.className = 'question-image';
                imgContainer.appendChild(img);
            }
            
            // Load paragraph if exists
            if (question.paragraph) {
                const paraContainer = document.getElementById('questionParagraphContainer');
                const para = document.createElement('div');
                para.className = 'question-paragraph';
                // Use innerHTML to render <br> tags properly
                para.innerHTML = question.paragraph.replace(/\n/g, '<br>');
                paraContainer.appendChild(para);
            }
            
            // Update question text
            document.getElementById('questionText').textContent = question.text || `Question ${index + 1}`;
            
            // Update options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            if (question.options && question.options.length > 0) {
                question.options.forEach((option, optIndex) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    
                    // Apply color coding based on test status
                    if (testSubmitted) {
                        if (optIndex === CONFIG.correctAnswers[index]) {
                            optionDiv.classList.add('correct');
                        } else if (optIndex === userAnswers[index] && userAnswers[index] !== CONFIG.correctAnswers[index]) {
                            optionDiv.classList.add('incorrect');
                        } else {
                            optionDiv.classList.add('unattempted');
                        }
                    } else if (userAnswers[index] === optIndex) {
                        optionDiv.classList.add('selected');
                    }
                    
                    optionDiv.innerHTML = `
                        <div class="option-label">${String.fromCharCode(65 + optIndex)}</div>
                        <div class="option-text">${option || `Option ${String.fromCharCode(65 + optIndex)}`}</div>
                    `;
                    
                    // Only allow clicking if test is not submitted
                    if (!testSubmitted) {
                        optionDiv.onclick = () => selectAnswer(optIndex);
                    } else {
                        optionDiv.style.cursor = 'default';
                    }
                    
                    optionsContainer.appendChild(optionDiv);
                });
            } else {
                // No options available
                optionsContainer.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">No options available for this question.</div>';
            }
            
            // Update explanation
            const explanation = document.getElementById('explanation');
            const explanationText = document.getElementById('explanationText');
            if (testSubmitted && question.explanation) {
                explanationText.textContent = question.explanation;
                explanation.classList.add('show');
            } else {
                explanation.classList.remove('show');
            }
            
            // Update navigation buttons
            updateNavigationButtons();
            
            // Update question grid
            updateQuestionGrid();
            
            // Update current score
            updateCurrentScore();
            
            // Show/hide View Solutions button
            updateViewSolutionsButton();
        }
        
        // Select answer
       function selectAnswer(optionIndex) {
    if (testSubmitted) return;
    
    userAnswers[currentQuestion] = optionIndex;
    
    // Update UI
    const options = document.querySelectorAll('#optionsContainer .option');
    options.forEach(opt => {
        opt.classList.remove('selected', 'unattempted');
    });
    options[optionIndex].classList.add('selected');
    
    // Save to localStorage
    saveAnswer(currentQuestion, optionIndex);
    
    // Update question grid
    updateQuestionGrid();
    
    // Update score
    updateCurrentScore();
}
        
        // Clear response for current question
       function clearResponse() {
    if (testSubmitted) return;
    
    userAnswers[currentQuestion] = null;
    
    // Update UI
    const options = document.querySelectorAll('#optionsContainer .option');
    options.forEach(opt => {
        opt.classList.remove('selected');
    });
    
    // Clear from localStorage
    clearSavedAnswer(currentQuestion);
    
    // Update question grid
    updateQuestionGrid();
    
    // Update score
    updateCurrentScore();
    
    // Show confirmation
    showToast('Response cleared!');
}
        
        // Show all solutions
        function showAllSolutions() {
            const solutionsPanel = document.getElementById('solutionsPanel');
            const solutionsContent = document.getElementById('solutionsContent');
            
            let solutionsHTML = '';
            
            for (let i = 0; i < CONFIG.totalQuestions; i++) {
                const question = CONFIG.questions[i];
                const correctAnswer = CONFIG.correctAnswers[i] !== undefined ? 
                    String.fromCharCode(65 + CONFIG.correctAnswers[i]) : 'N/A';
                const userAnswer = userAnswers[i] !== null ? 
                    String.fromCharCode(65 + userAnswers[i]) : 'Not Attempted';
                const status = userAnswers[i] === CONFIG.correctAnswers[i] ? '‚úÖ Correct' : 
                             userAnswers[i] !== null ? '‚ùå Wrong' : '‚≠ï Unattempted';
                
                solutionsHTML += `
                    <div class="solution-item">
                        <div class="solution-question">
                            Q${i + 1}: ${question.text || `Question ${i + 1}`}
                        </div>
                        <div style="display: flex; gap: 20px; margin: 10px 0;">
                            <span><strong>Your Answer:</strong> ${userAnswer}</span>
                            <span><strong>Correct Answer:</strong> ${correctAnswer}</span>
                            <span><strong>Status:</strong> ${status}</span>
                        </div>
                        <div class="solution-explanation">
                            <strong>Explanation:</strong> ${question.explanation || 'No explanation provided'}
                        </div>
                    </div>
                `;
            }
            
            solutionsContent.innerHTML = solutionsHTML;
            solutionsPanel.classList.add('active');
            
            // Scroll to solutions
            solutionsPanel.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Update question grid with colors after submission
        function updateQuestionGrid() {
            for (let i = 0; i < CONFIG.totalQuestions; i++) {
                const btn = document.getElementById(`qBtn${i}`);
                if (!btn) continue;
                
                btn.classList.remove('active', 'attempted', 'unattempted', 'correct', 'wrong');
                
                if (i === currentQuestion) {
                    btn.classList.add('active');
                }
                
                if (testSubmitted) {
                    // After submission: green=correct, red=wrong, gray=unattempted
                    if (userAnswers[i] === null) {
                        btn.classList.add('unattempted');
                        questionStatus[i] = 'unattempted';
                    } else if (userAnswers[i] === CONFIG.correctAnswers[i]) {
                        btn.classList.add('correct');
                        questionStatus[i] = 'correct';
                    } else {
                        btn.classList.add('wrong');
                        questionStatus[i] = 'wrong';
                    }
                } else {
                    // Before submission: green=attempted, gray=unattempted
                    if (userAnswers[i] !== null) {
                        btn.classList.add('attempted');
                    } else {
                        btn.classList.add('unattempted');
                    }
                }
            }
        }
        
        // Update View Solutions button
        function updateViewSolutionsButton() {
            const viewSolutionsBtn = document.getElementById('viewSolutionsBtn');
            if (testSubmitted) {
                viewSolutionsBtn.classList.add('show');
            } else {
                viewSolutionsBtn.classList.remove('show');
            }
        }
        
        // Navigate to question
        function navigateToQuestion(index) {
            loadQuestion(index);
        }
        
        // Next question
        function nextQuestion() {
            if (currentQuestion < CONFIG.totalQuestions - 1) {
                loadQuestion(currentQuestion + 1);
            }
        }
        
        // Previous question
        function prevQuestion() {
            if (currentQuestion > 0) {
                loadQuestion(currentQuestion - 1);
            }
        }
        
        // Update navigation buttons
        function updateNavigationButtons() {
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            document.getElementById('nextBtn').disabled = currentQuestion === CONFIG.totalQuestions - 1;
        }
        
        // Timer functions
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitTest();
                    alert("‚è∞ Time's up! Test has been submitted.");
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change color when time is low
            if (timeLeft < 300) { // 5 minutes
                document.getElementById('timer').style.color = '#ff6b6b';
            }
        }
        
        // Update current score
        function updateCurrentScore() {
            let score = 0;
            for (let i = 0; i < CONFIG.totalQuestions; i++) {
                if (userAnswers[i] !== null) {
                    if (userAnswers[i] === CONFIG.correctAnswers[i]) {
                        score += 1;
                    } else {
                        score -= CONFIG.negativeMarking;
                    }
                }
            }
            document.getElementById('currentScore').textContent = Math.max(0, score).toFixed(2);
        }
        
        // Submit test and show analysis page
        function submitTest() {
            if (testSubmitted) return;
            
            clearInterval(timerInterval);
            testSubmitted = true;
document.getElementById('scoreDisplay').style.display = 'block';
            
            // Calculate results
            let correct = 0;
            let incorrect = 0;
            let unanswered = 0;
            let score = 0;
            const timeTaken = Math.floor((Date.now() - testStartTime) / 1000);
            
            for (let i = 0; i < CONFIG.totalQuestions; i++) {
                if (userAnswers[i] === null) {
                    unanswered++;
                } else if (userAnswers[i] === CONFIG.correctAnswers[i]) {
                    correct++;
                    score += 1;
                } else {
                    incorrect++;
                    score -= CONFIG.negativeMarking;
                }
            }
            
            // Ensure score is not negative
            score = Math.max(0, score);

saveTestAttempt(score, CONFIG.totalQuestions, correct, incorrect, unanswered, timeTaken);
            
            // Display results
            displayResults(correct, incorrect, unanswered, score, timeTaken);
            
            // Reload current question to show color coding
            loadQuestion(currentQuestion);
            
            // Show View Solutions button
            updateViewSolutionsButton();
            
            // Show analysis page after 1 seconds
            setTimeout(() => {
                showAnalysisPage(correct, incorrect, unanswered, score, timeTaken);
            }, 1000);
        }
        
        // Show analysis page
        function showAnalysisPage(correct, incorrect, unanswered, score, timeTaken) {
            // Hide test container and result panel
            document.getElementById('testContainer').style.display = 'none';
            document.getElementById('resultPanel').classList.remove('active');
            
            // Update analysis page data
            document.getElementById('analysisTestTitle').textContent = CONFIG.testTitle;
            document.getElementById('analysisFinalScore').textContent = `${score.toFixed(2)}/${CONFIG.totalQuestions}`;
            document.getElementById('analysisCorrectCount').textContent = correct;
            document.getElementById('analysisIncorrectCount').textContent = incorrect;
            document.getElementById('analysisUnansweredCount').textContent = unanswered;
            
            // Format time taken
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            document.getElementById('analysisTimeTaken').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update performance summary
            const performanceSummary = document.getElementById('analysisPerformanceSummary');
            if (incorrect > 0) {
                const deduction = (incorrect * CONFIG.negativeMarking).toFixed(2);
                performanceSummary.innerHTML = `
                    <p><strong>Total Questions:</strong> ${CONFIG.totalQuestions}</p>
                    <p><strong>Correct Answers:</strong> ${correct}</p>
                    <p><strong>Wrong Answers:</strong> ${incorrect} (Deduction: ${deduction} points)</p>
                    <p><strong>Unanswered:</strong> ${unanswered}</p>
                    <p><strong>Negative Marking:</strong> ${CONFIG.negativeMarking} per wrong answer</p>
                    <p><strong>Final Score:</strong> ${score.toFixed(2)}/${CONFIG.totalQuestions}</p>
                `;
            } else {
                performanceSummary.innerHTML = `
                    <p><strong>Total Questions:</strong> ${CONFIG.totalQuestions}</p>
                    <p><strong>Correct Answers:</strong> ${correct}</p>
                    <p><strong>Wrong Answers:</strong> 0</p>
                    <p><strong>Unanswered:</strong> ${unanswered}</p>
                    <p><strong>Negative Marking:</strong> No deductions</p>
                    <p><strong>Final Score:</strong> ${score.toFixed(2)}/${CONFIG.totalQuestions} (Perfect!)</p>
                `;
            }
            
            
            // Show analysis page
            document.getElementById('analysisPage').classList.add('active');

            displayPreviousAttempts();
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Generate question-wise analysis
        function generateQuestionAnalysis() {
            const container = document.getElementById('questionAnalysisContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < CONFIG.totalQuestions; i++) {
                const question = CONFIG.questions[i];
                const userAnswer = userAnswers[i];
                const correctAnswer = CONFIG.correctAnswers[i];
                
                let status = 'unattempted';
                let statusText = 'Unattempted';
                let statusClass = 'status-unattempted';
                let itemClass = 'unattempted';
                
                if (userAnswer === null) {
                    status = 'unattempted';
                    statusText = '‚≠ï Unattempted';
                    statusClass = 'status-unattempted';
                    itemClass = 'unattempted';
                } else if (userAnswer === correctAnswer) {
                    status = 'correct';
                    statusText = '‚úÖ Correct';
                    statusClass = 'status-correct';
                    itemClass = 'correct';
                } else {
                    status = 'incorrect';
                    statusText = '‚ùå Wrong';
                    statusClass = 'status-incorrect';
                    itemClass = 'incorrect';
                }
                
                const userAnswerText = userAnswer !== null ? 
                    `Your Answer: ${String.fromCharCode(65 + userAnswer)}` : 
                    'Your Answer: Not Attempted';
                
                const correctAnswerText = `Correct Answer: ${String.fromCharCode(65 + correctAnswer)}`;
                
                const questionHTML = `
                    <div class="question-analysis-item ${itemClass}">
                        <div class="question-analysis-number">Question ${i + 1}</div>
                        <div class="${statusClass} question-analysis-status">${statusText}</div>
                        <div style="margin: 10px 0; font-weight: 600;">${question.text || `Question ${i + 1}`}</div>
                        <div style="display: flex; gap: 20px; margin: 10px 0;">
                            <span>${userAnswerText}</span>
                            <span>${correctAnswerText}</span>
                        </div>
                        <div style="color: #666; font-size: 0.95rem;">
                            <strong>Explanation:</strong> ${question.explanation || 'No explanation provided'}
                        </div>
                    </div>
                `;
                
                container.innerHTML += questionHTML;
            }
        }
        
        // Back to test from analysis
        function backToTest() {
            // Hide analysis page
            document.getElementById('analysisPage').classList.remove('active');
            
            // Show test container
            document.getElementById('testContainer').style.display = 'flex';

 // Make score visible (since test is already submitted)
document.getElementById('scoreDisplay').style.display = 'block';
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // ========== üÜï ADD THIS NEW FUNCTION ==========
function goToAnalysisFromResults() {
    // Hide result panel
    document.getElementById('resultPanel').classList.remove('active');
    
    // Show analysis page
    document.getElementById('analysisPage').classList.add('active');
}
// ========== END OF NEW FUNCTION ==========

        // Display results
        function displayResults(correct, incorrect, unanswered, score, timeTaken) {
            // Update result panel
            document.getElementById('finalScore').textContent = `${score.toFixed(2)}/${CONFIG.totalQuestions}`;
            document.getElementById('correctCount').textContent = correct;
            document.getElementById('incorrectCount').textContent = incorrect;
            document.getElementById('unansweredCount').textContent = unanswered;
            
            // Format time taken
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            document.getElementById('timeTaken').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Negative marking info
            const negativeInfo = document.getElementById('negativeMarkingInfo');
            if (incorrect > 0) {
                const deduction = (incorrect * CONFIG.negativeMarking).toFixed(2);
                negativeInfo.innerHTML = `
                    Wrong Answers: ${incorrect}<br>
                    Deduction per wrong answer: ${CONFIG.negativeMarking}<br>
                    Total deduction: ${deduction} points
                `;
            } else {
                negativeInfo.innerHTML = "Perfect! No negative marking deductions.";
            }
            
            // Show result panel
            document.getElementById('resultPanel').classList.add('active');
            
            // Show explanations
            document.getElementById('explanation').classList.add('show');
            
            // Scroll to top
            document.querySelector('.main-content').scrollTop = 0;
        }
        
        // Reset test
        function resetTest() {
            if (confirm("Are you sure you want to reset the test? All answers will be lost.")) {
                // Clear state
                userAnswers = new Array(CONFIG.totalQuestions).fill(null);
                timeLeft = CONFIG.timeLimit;
                testSubmitted = false;
                testStartTime = Date.now();
                questionStatus = new Array(CONFIG.totalQuestions).fill('unattempted');
                
                // Clear localStorage
                localStorage.clear();
                
                // Reset UI
                document.getElementById('resultPanel').classList.remove('active');
                document.getElementById('explanation').classList.remove('show');
                document.getElementById('solutionsPanel').classList.remove('active');
                document.getElementById('viewSolutionsBtn').classList.remove('show');
                document.getElementById('analysisPage').classList.remove('active');
                document.getElementById('testContainer').style.display = 'flex';
                
                // Reload first question
                loadQuestion(0);
                
                // Restart timer
                clearInterval(timerInterval);
                startTimer();
            }
        }
        
        // Save answer to localStorage
        function saveAnswer(questionIndex, answerIndex) {
            const key = `test_${CONFIG.testTitle.replace(/\s+/g, '_')}_q${questionIndex}`;
            localStorage.setItem(key, answerIndex);
        }
        
        // Clear saved answer
        function clearSavedAnswer(questionIndex) {
            const key = `test_${CONFIG.testTitle.replace(/\s+/g, '_')}_q${questionIndex}`;
            localStorage.removeItem(key);
        }
        
        // Load saved answers
        function loadSavedAnswers() {
               // COMMENT OUT EVERYTHING INSIDE:
               /*
           for (let i = 0; i < CONFIG.totalQuestions; i++) {
                const key = `test_${CONFIG.testTitle.replace(/\s+/g, '_')}_q${i}`;
                const saved = localStorage.getItem(key);
                if (saved !== null) {
                    userAnswers[i] = parseInt(saved);
                }
            }
            updateCurrentScore();
            updateQuestionGrid();
             */
        }
        
        // Show toast notification
        function showToast(message) {
            // Create toast element
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-color);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 1000;
                animation: slideIn 0.3s ease, fadeOut 0.3s ease 2s forwards;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; transform: translateY(-10px); }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(toast);
            
            // Remove after animation
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 2300);
        }
        
        // Start test when page loads
                window.onload = function() {
    // Hide the test container initially
    document.getElementById('testContainer').style.display = 'none';
    document.getElementById('loadingScreen').style.display = 'none';
    
    // Load test details for start screen
    try {
        const configScript = document.getElementById('testConfig');
        if (configScript) {
            const config = JSON.parse(configScript.textContent);
            
            // Update start screen with real data
            document.getElementById('startTestTitle').textContent = config.testTitle || "MCQ Test";
            
            // Total Questions
            const totalQ = config.totalQuestions || config.questions?.length || 0;
            document.getElementById('startTotalQ').textContent = totalQ;
            
            // Time Limit
            const minutes = Math.floor((config.timeLimit || 1800) / 60);
            document.getElementById('startTimeLimit').textContent = `${minutes} minutes`;
            
            // Negative Marking
            let negativeDisplay = "No";
            if (config.negativeMarking === 0.25) negativeDisplay = "1/4";
            else if (config.negativeMarking === 0.33) negativeDisplay = "1/3";
            else if (config.negativeMarking === 0.5) negativeDisplay = "1/2";
            document.getElementById('startNegative').textContent = negativeDisplay;
        }
    } catch (e) {
        console.log("Could not load config for start screen:", e);
    }
    
    // Show start button
    document.getElementById('startButton').addEventListener('click', function() {
        // Hide start screen
        document.getElementById('startScreen').style.display = 'none';
        
        // Show test container
        document.getElementById('testContainer').style.display = 'flex';
        
        // Initialize the test
        initTest();
    });
};
    </script>
</body>
</html>
